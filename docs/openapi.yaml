openapi: 3.1.0
info:
  title: ArP - Artwork Provenance API
  description: |
    REST API for managing artwork provenance data using Semantic Web technologies.
    
    This API provides endpoints for:
    - Managing artworks (CRUD operations)
    - Tracking provenance chains (ownership history)
    - Executing SPARQL queries against the RDF knowledge base
    - Full-text search with faceted filtering
    - Artwork recommendations
    - QR code generation for artwork identification
    - **External SPARQL Integration**: Query DBpedia, Wikidata, and Getty AAT for enriched artwork metadata
  version: 1.0.0
  contact:
    name: ArP Development Team
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: Local development server
  - url: https://api.arp.example.org/api
    description: Production server

tags:
  - name: artworks
    description: Artwork management operations
  - name: provenance
    description: Provenance chain operations
  - name: sparql
    description: SPARQL query execution
  - name: search
    description: Full-text search operations
  - name: recommendations
    description: Artwork recommendations
  - name: qr
    description: QR code generation
  - name: external
    description: External SPARQL integration (DBpedia, Wikidata, Getty AAT)
  - name: statistics
    description: Getty AAT-based artwork statistics and analytics

paths:
  # ============================================
  # ARTWORKS CRUD
  # ============================================
  /artworks:
    get:
      tags: [artworks]
      summary: List all artworks
      description: Retrieve a paginated list of artworks with optional filtering and sorting.
      operationId: listArtworks
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: artist
          in: query
          description: Filter by artist name
          schema:
            type: string
        - name: period
          in: query
          description: Filter by art historical period
          schema:
            type: string
        - name: search
          in: query
          description: Search term for quick filtering
          schema:
            type: string
        - name: sort
          in: query
          description: Sort field
          schema:
            type: string
            enum: [title, dateCreated, -title, -dateCreated]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArtworkListResponse'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags: [artworks]
      summary: Create a new artwork
      description: Create a new artwork entry in the knowledge base.
      operationId: createArtwork
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ArtworkCreate'
      responses:
        '201':
          description: Artwork created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artwork'
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

  /artworks/{id}:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'

    get:
      tags: [artworks]
      summary: Get artwork by ID
      description: Retrieve a single artwork by its unique identifier.
      operationId: getArtwork
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artwork'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      tags: [artworks]
      summary: Update artwork
      description: Update an existing artwork's information.
      operationId: updateArtwork
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ArtworkUpdate'
      responses:
        '200':
          description: Artwork updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artwork'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags: [artworks]
      summary: Delete artwork
      description: Delete an artwork from the knowledge base.
      operationId: deleteArtwork
      responses:
        '204':
          description: Artwork deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # PROVENANCE CHAIN
  # ============================================
  /artworks/{id}/provenance:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'

    get:
      tags: [provenance]
      summary: Get provenance chain
      description: Retrieve the complete provenance (ownership history) chain for an artwork.
      operationId: getProvenance
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProvenanceRecord'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags: [provenance]
      summary: Add provenance event
      description: Add a new provenance event to an artwork's history.
      operationId: addProvenanceEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProvenanceEventCreate'
      responses:
        '201':
          description: Provenance event added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProvenanceRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

  /artworks/{id}/provenance/{eventId}:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'
      - $ref: '#/components/parameters/EventId'

    put:
      tags: [provenance]
      summary: Update provenance event
      description: Update an existing provenance event.
      operationId: updateProvenanceEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProvenanceEventUpdate'
      responses:
        '200':
          description: Provenance event updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProvenanceRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags: [provenance]
      summary: Delete provenance event
      description: Remove a provenance event from an artwork's history.
      operationId: deleteProvenanceEvent
      responses:
        '204':
          description: Provenance event deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # SPARQL QUERY
  # ============================================
  /sparql:
    post:
      tags: [sparql]
      summary: Execute SPARQL query
      description: Execute a SPARQL query against the Fuseki RDF triplestore.
      operationId: executeSparql
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SPARQLQuery'
      responses:
        '200':
          description: Query executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SPARQLResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /sparql/status:
    get:
      tags: [sparql]
      summary: Check Fuseki status
      description: Check the connection status to the Fuseki SPARQL endpoint.
      operationId: getSparqlStatus
      responses:
        '200':
          description: Status check successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SPARQLStatus'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # SEARCH
  # ============================================
  /search:
    get:
      tags: [search]
      summary: Search artworks
      description: Full-text search across artworks with faceted filtering support.
      operationId: searchArtworks
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string
          schema:
            type: string
            minLength: 1
        - name: artist
          in: query
          description: Filter by artist name
          schema:
            type: string
        - name: period
          in: query
          description: Filter by art period
          schema:
            type: string
        - name: medium
          in: query
          description: Filter by medium/technique
          schema:
            type: string
        - name: location
          in: query
          description: Filter by current location
          schema:
            type: string
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # RECOMMENDATIONS
  # ============================================
  /artworks/{id}/recommendations:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'

    get:
      tags: [recommendations]
      summary: Get artwork recommendations
      description: Get similar artwork recommendations based on the specified artwork.
      operationId: getRecommendations
      parameters:
        - name: limit
          in: query
          description: Maximum number of recommendations
          schema:
            type: integer
            default: 5
            minimum: 1
            maximum: 20
      responses:
        '200':
          description: Recommendations retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Artwork'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # QR CODE
  # ============================================
  /artworks/{id}/qr:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'

    get:
      tags: [qr]
      summary: Generate QR code
      description: Generate a QR code for the specified artwork for easy identification and sharing.
      operationId: getQRCode
      parameters:
        - name: size
          in: query
          description: QR code size in pixels
          schema:
            type: integer
            default: 200
            minimum: 50
            maximum: 1000
        - name: format
          in: query
          description: Output format
          schema:
            type: string
            enum: [png, svg]
            default: png
      responses:
        '200':
          description: QR code generated successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/svg+xml:
              schema:
                type: string
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ============================================
  # EXTERNAL SPARQL INTEGRATION
  # ============================================
  /artworks/{id}/enrich:
    parameters:
      - $ref: '#/components/parameters/ArtworkId'

    get:
      tags: [external]
      summary: Enrich artwork with external data
      description: |
        Fetch and combine external data for an artwork from DBpedia, Wikidata, and Getty AAT.
        
        This endpoint:
        1. Queries the local Fuseki triplestore for owl:sameAs links
        2. Fetches data from each linked external source
        3. Returns combined enrichment data including artist information
        
        Results are cached for performance.
      operationId: enrichArtwork
      responses:
        '200':
          description: Enrichment data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArtworkEnrichment'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/dbpedia/artwork/{resource}:
    get:
      tags: [external]
      summary: Query DBpedia for artwork information
      description: Fetch artwork metadata from DBpedia including abstract, thumbnail, artist, and museum information.
      operationId: getDbpediaArtwork
      parameters:
        - name: resource
          in: path
          required: true
          description: "DBpedia resource name or full URI (e.g., 'Mona_Lisa')"
          schema:
            type: string
      responses:
        '200':
          description: DBpedia data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/dbpedia/artist/{resource}:
    get:
      tags: [external]
      summary: Query DBpedia for artist information
      description: Fetch artist biographical data from DBpedia including birth/death dates, nationality, and art movement.
      operationId: getDbpediaArtist
      parameters:
        - name: resource
          in: path
          required: true
          description: "DBpedia resource name or full URI (e.g., 'Leonardo_da_Vinci')"
          schema:
            type: string
      responses:
        '200':
          description: DBpedia artist data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/wikidata/artwork/{entity}:
    get:
      tags: [external]
      summary: Query Wikidata for artwork information
      description: Fetch artwork metadata from Wikidata including image, inception date, materials, and location.
      operationId: getWikidataArtwork
      parameters:
        - name: entity
          in: path
          required: true
          description: "Wikidata Q-ID or full URI (e.g., 'Q12418')"
          schema:
            type: string
      responses:
        '200':
          description: Wikidata data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/wikidata/artist/{entity}:
    get:
      tags: [external]
      summary: Query Wikidata for artist information
      description: Fetch artist biographical data from Wikidata including birth/death dates, nationality, and occupation.
      operationId: getWikidataArtist
      parameters:
        - name: entity
          in: path
          required: true
          description: "Wikidata Q-ID or full URI (e.g., 'Q762' for Leonardo da Vinci)"
          schema:
            type: string
      responses:
        '200':
          description: Wikidata artist data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/getty/{aat_id}:
    get:
      tags: [external]
      summary: Query Getty AAT for term information
      description: Fetch term information from Getty Art & Architecture Thesaurus including preferred label and scope note.
      operationId: getGettyTerm
      parameters:
        - name: aat_id
          in: path
          required: true
          description: "Getty AAT ID (e.g., '300015050' for oil paint)"
          schema:
            type: string
      responses:
        '200':
          description: Getty AAT term retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /external/cache/clear:
    post:
      tags: [external]
      summary: Clear external query cache
      description: Clear all cached external query results.
      operationId: clearCache
      responses:
        '200':
          description: Cache cleared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cache cleared successfully"

  # ============================================
  # STATISTICS ENDPOINTS
  # ============================================
  /statistics/materials:
    get:
      tags: [statistics]
      summary: Get artwork distribution by Getty AAT materials
      description: |
        Retrieve artwork counts grouped by Getty Art & Architecture Thesaurus (AAT) material types.
        
        This endpoint:
        1. Queries the local triplestore for artworks with schema:artMedium links to Getty AAT
        2. Counts artworks for each unique material
        3. Enriches results with Getty AAT labels and scope notes via federated query
        
        Results are ordered by artwork count (descending).
      operationId: getMaterialDistribution
      responses:
        '200':
          description: Material distribution retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaterialDistribution'
        '500':
          $ref: '#/components/responses/InternalError'

  /statistics/materials/hierarchy:
    get:
      tags: [statistics]
      summary: Get material distribution by Getty AAT hierarchy
      description: |
        Retrieve artwork distribution organized by Getty AAT broader categories.
        
        This endpoint:
        1. Gets the basic material distribution
        2. Groups materials by their parent/broader categories in the Getty hierarchy
        3. Returns a hierarchical view of material usage
        
        Useful for understanding which broad categories of materials are most used.
      operationId: getMaterialHierarchy
      responses:
        '200':
          description: Material hierarchy retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaterialHierarchyResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /statistics/temporal:
    get:
      tags: [statistics]
      summary: Get temporal trends of Getty material usage
      description: |
        Retrieve material usage trends across art historical periods.
        
        This endpoint:
        1. Cross-references artwork periods with Getty AAT materials
        2. Shows which materials were used in each time period
        3. Helps identify trends in artistic techniques across history
        
        Periods are based on arp:artworkPeriod values in the triplestore.
      operationId: getTemporalTrends
      responses:
        '200':
          description: Temporal trends retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemporalTrendsResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /statistics/cross-analysis:
    get:
      tags: [statistics]
      summary: Get cross-category analysis (e.g., period x material)
      description: |
        Retrieve a cross-tabulation matrix for two dimensions of artwork data.
        
        Supported dimensions:
        - period: Art historical period
        - location: Current location/museum
        - artist: Artist name
        - material: Getty AAT material type
        
        Returns a matrix showing counts for each combination of dimension values.
      operationId: getCrossAnalysis
      parameters:
        - name: dimension_x
          in: query
          description: X-axis dimension
          schema:
            type: string
            enum: [period, location, artist]
            default: period
        - name: dimension_y
          in: query
          description: Y-axis dimension
          schema:
            type: string
            enum: [material]
            default: material
      responses:
        '200':
          description: Cross-analysis matrix retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CrossAnalysisResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /statistics/sparql:
    post:
      tags: [statistics]
      summary: Execute custom statistics SPARQL query
      description: |
        Execute a custom SPARQL query with Getty namespace prefixes auto-injected.
        
        Pre-injected prefixes (when enabled):
        - aat: Getty AAT namespace
        - gvp: Getty Vocabulary Program ontology
        - skos: SKOS vocabulary
        - schema: Schema.org
        - arp: ArP ontology
        - dc: Dublin Core
        - dcterms: Dublin Core Terms
        
        Use this for advanced statistical queries not covered by predefined endpoints.
      operationId: executeStatisticsQuery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StatisticsQueryRequest'
      responses:
        '200':
          description: Query executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsQueryResponse'
        '500':
          $ref: '#/components/responses/InternalError'

# ============================================
# COMPONENTS
# ============================================
components:
  parameters:
    ArtworkId:
      name: id
      in: path
      required: true
      description: Unique artwork identifier (URI or ID)
      schema:
        type: string
        example: "artwork_mona_lisa"

    EventId:
      name: eventId
      in: path
      required: true
      description: Unique provenance event identifier
      schema:
        type: string
        example: "prov_001"

    PageParam:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        default: 1
        minimum: 1

    LimitParam:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

  schemas:
    # ----------------------------------------
    # Artwork Schemas
    # ----------------------------------------
    Artwork:
      type: object
      required: [id, title]
      properties:
        id:
          type: string
          description: Unique identifier (URI)
          example: "artwork_mona_lisa"
        title:
          type: string
          description: Title of the artwork
          example: "Mona Lisa"
        artist:
          type: string
          description: Artist name
          example: "Leonardo da Vinci"
        artistUri:
          type: string
          description: Artist URI in the knowledge base
          example: "artist_davinci"
        dateCreated:
          type: string
          description: Date or period of creation
          example: "1503-1519"
        medium:
          type: string
          description: Medium/technique used
          example: "Oil on poplar panel"
        dimensions:
          type: string
          description: Physical dimensions
          example: "77 cm × 53 cm"
        description:
          type: string
          description: Description of the artwork
        imageUrl:
          type: string
          format: uri
          description: URL to artwork image
        currentLocation:
          type: string
          description: Current location/museum
          example: "Louvre Museum, Paris"
        period:
          type: string
          description: Art historical period
          example: "High Renaissance"
        style:
          type: string
          description: Artistic style
          example: "Renaissance"
        provenance:
          type: array
          items:
            $ref: '#/components/schemas/ProvenanceRecord'
          description: Provenance history (when embedded)
        externalLinks:
          $ref: '#/components/schemas/ExternalLinks'

    ArtworkCreate:
      type: object
      required: [title]
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 500
        artist:
          type: string
        dateCreated:
          type: string
        medium:
          type: string
        dimensions:
          type: string
        description:
          type: string
        imageUrl:
          type: string
          format: uri
        period:
          type: string
        style:
          type: string

    ArtworkUpdate:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 500
        artist:
          type: string
        dateCreated:
          type: string
        medium:
          type: string
        dimensions:
          type: string
        description:
          type: string
        imageUrl:
          type: string
          format: uri
        period:
          type: string
        style:
          type: string

    ArtworkListResponse:
      type: object
      required: [items, total, page, limit, hasMore]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Artwork'
        total:
          type: integer
          description: Total number of artworks matching the query
        page:
          type: integer
          description: Current page number
        limit:
          type: integer
          description: Items per page
        hasMore:
          type: boolean
          description: Whether there are more pages

    ExternalLinks:
      type: object
      properties:
        dbpedia:
          type: string
          format: uri
          description: DBpedia resource URI
        wikidata:
          type: string
          format: uri
          description: Wikidata entity URI
        getty:
          type: string
          format: uri
          description: Getty AAT URI

    # ----------------------------------------
    # Provenance Schemas
    # ----------------------------------------
    ProvenanceRecord:
      type: object
      required: [id, event, date]
      properties:
        id:
          type: string
          description: Unique event identifier
          example: "prov_001"
        date:
          type: string
          description: Date of the event
          example: "1519-01-01"
        event:
          type: string
          description: Type of provenance event
          enum:
            - Creation
            - Sale
            - Gift
            - Bequest
            - Theft
            - Recovery
            - Loan
            - Return
            - Acquisition
          example: "Acquisition"
        owner:
          type: string
          description: Owner name at this point
          example: "King Francis I of France"
        location:
          type: string
          description: Location during this event
          example: "Château d'Amboise"
        description:
          type: string
          description: Additional event details
        sourceUri:
          type: string
          format: uri
          description: Source document or reference URI
        order:
          type: integer
          description: Order in the provenance chain

    ProvenanceEventCreate:
      type: object
      required: [event, date]
      properties:
        event:
          type: string
          enum: [Creation, Sale, Gift, Bequest, Theft, Recovery, Loan, Return, Acquisition]
        date:
          type: string
        owner:
          type: string
        location:
          type: string
        description:
          type: string
        sourceUri:
          type: string
          format: uri

    ProvenanceEventUpdate:
      type: object
      properties:
        event:
          type: string
          enum: [Creation, Sale, Gift, Bequest, Theft, Recovery, Loan, Return, Acquisition]
        date:
          type: string
        owner:
          type: string
        location:
          type: string
        description:
          type: string
        sourceUri:
          type: string
          format: uri

    # ----------------------------------------
    # SPARQL Schemas
    # ----------------------------------------
    SPARQLQuery:
      type: object
      required: [query]
      properties:
        query:
          type: string
          description: SPARQL query string
          example: "SELECT ?s ?p ?o WHERE { ?s ?p ?o } LIMIT 10"

    SPARQLResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the query executed successfully
        results:
          type: object
          properties:
            head:
              type: object
              properties:
                vars:
                  type: array
                  items:
                    type: string
            bindings:
              type: array
              items:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    type:
                      type: string
                    value:
                      type: string
        error:
          type: string
          description: Error message if query failed

    SPARQLStatus:
      type: object
      required: [connected]
      properties:
        connected:
          type: boolean
          description: Whether Fuseki is reachable

    # ----------------------------------------
    # Search Schemas
    # ----------------------------------------
    SearchResponse:
      type: object
      required: [results, total]
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/Artwork'
        total:
          type: integer
          description: Total number of matching results
        page:
          type: integer
        limit:
          type: integer
        facets:
          $ref: '#/components/schemas/SearchFacets'

    SearchFacets:
      type: object
      properties:
        artists:
          type: array
          items:
            $ref: '#/components/schemas/FacetItem'
        periods:
          type: array
          items:
            $ref: '#/components/schemas/FacetItem'
        media:
          type: array
          items:
            $ref: '#/components/schemas/FacetItem'

    FacetItem:
      type: object
      required: [name, count]
      properties:
        name:
          type: string
        count:
          type: integer

    # ----------------------------------------
    # External Integration Schemas
    # ----------------------------------------
    LinkedEntity:
      type: object
      description: A linked entity with URI and label
      properties:
        uri:
          type: string
          format: uri
          description: Entity URI
        label:
          type: string
          description: Human-readable label

    ExternalQueryResponse:
      type: object
      description: Generic response for external SPARQL queries
      properties:
        success:
          type: boolean
        data:
          type: object
          additionalProperties: true
        error:
          type: string
        source:
          type: string
          enum: [dbpedia, wikidata, getty]

    DBpediaInfo:
      type: object
      description: Information retrieved from DBpedia
      properties:
        source:
          type: string
          example: "dbpedia"
        uri:
          type: string
          format: uri
        abstract:
          type: string
          description: English abstract from DBpedia
        thumbnail:
          type: string
          format: uri
          description: Thumbnail image URL
        artist:
          $ref: '#/components/schemas/LinkedEntity'
        museum:
          $ref: '#/components/schemas/LinkedEntity'
        wikidata_uri:
          type: string
          format: uri

    WikidataInfo:
      type: object
      description: Information retrieved from Wikidata
      properties:
        source:
          type: string
          example: "wikidata"
        uri:
          type: string
          format: uri
        qid:
          type: string
          description: Wikidata Q-ID
          example: "Q12418"
        image:
          type: string
          format: uri
        inception:
          type: string
          description: Date of creation
        creator:
          $ref: '#/components/schemas/LinkedEntity'
        location:
          $ref: '#/components/schemas/LinkedEntity'
        material:
          $ref: '#/components/schemas/LinkedEntity'
        genre:
          $ref: '#/components/schemas/LinkedEntity'
        movement:
          $ref: '#/components/schemas/LinkedEntity'

    GettyTerm:
      type: object
      description: Getty AAT term information
      properties:
        source:
          type: string
          example: "getty"
        uri:
          type: string
          format: uri
        prefLabel:
          type: string
          description: Preferred label in English
          example: "oil paint"
        scopeNote:
          type: string
          description: Definition or scope note
        broader:
          $ref: '#/components/schemas/LinkedEntity'

    ArtworkEnrichment:
      type: object
      description: Combined enrichment data from external sources
      required: [artwork_id]
      properties:
        artwork_id:
          type: string
          description: The artwork identifier
          example: "artwork_mona_lisa"
        dbpedia:
          $ref: '#/components/schemas/DBpediaInfo'
        wikidata:
          $ref: '#/components/schemas/WikidataInfo'
        getty:
          type: array
          items:
            $ref: '#/components/schemas/GettyTerm'
        artist_dbpedia:
          $ref: '#/components/schemas/DBpediaInfo'
        artist_wikidata:
          $ref: '#/components/schemas/WikidataInfo'

    # ----------------------------------------
    # Statistics Schemas
    # ----------------------------------------
    GettyMaterialStat:
      type: object
      description: Statistics for a single Getty AAT material type
      required: [getty_uri, artwork_count]
      properties:
        getty_uri:
          type: string
          format: uri
          description: Getty AAT URI
          example: "http://vocab.getty.edu/aat/300015050"
        pref_label:
          type: string
          description: Preferred label from Getty AAT
          example: "oil paint"
        scope_note:
          type: string
          description: Scope note/definition from Getty AAT
        artwork_count:
          type: integer
          description: Number of artworks using this material
          example: 10
        broader_category:
          type: string
          description: Broader category label from Getty hierarchy
          example: "paint"
        broader_uri:
          type: string
          format: uri
          description: Broader category URI from Getty hierarchy

    MaterialDistribution:
      type: object
      description: Distribution of artworks by Getty AAT material types
      required: [total_artworks, materials, generated_at]
      properties:
        total_artworks:
          type: integer
          description: Total number of artworks with Getty material links
          example: 15
        materials:
          type: array
          items:
            $ref: '#/components/schemas/GettyMaterialStat'
        generated_at:
          type: string
          format: date-time
          description: Timestamp when statistics were generated

    HierarchyStat:
      type: object
      description: Statistics for a Getty AAT broader category
      required: [category_uri, category_label, subcategories, total_count]
      properties:
        category_uri:
          type: string
          format: uri
          description: Getty AAT category URI
        category_label:
          type: string
          description: Category label from Getty AAT
          example: "painting techniques"
        subcategories:
          type: array
          items:
            $ref: '#/components/schemas/GettyMaterialStat'
        total_count:
          type: integer
          description: Total artworks in this category
          example: 12

    MaterialHierarchyResponse:
      type: object
      description: Material hierarchy statistics response
      required: [total_artworks, categories, generated_at]
      properties:
        total_artworks:
          type: integer
          description: Total number of artworks with Getty material links
        categories:
          type: array
          items:
            $ref: '#/components/schemas/HierarchyStat'
        generated_at:
          type: string
          format: date-time
          description: Timestamp when statistics were generated

    PeriodMaterialStat:
      type: object
      description: Material statistics for a specific time period
      required: [getty_uri, count]
      properties:
        getty_uri:
          type: string
          format: uri
          description: Getty AAT material URI
        pref_label:
          type: string
          description: Material label
        count:
          type: integer
          description: Number of artworks

    TemporalTrend:
      type: object
      description: Material distribution for a specific time period
      required: [period, total_artworks, materials]
      properties:
        period:
          type: string
          description: Time period
          example: "Renaissance"
        total_artworks:
          type: integer
          description: Total artworks in this period
        materials:
          type: array
          items:
            $ref: '#/components/schemas/PeriodMaterialStat'

    TemporalTrendsResponse:
      type: object
      description: Temporal trends response
      required: [total_periods, trends, generated_at]
      properties:
        total_periods:
          type: integer
          description: Number of distinct periods
        trends:
          type: array
          items:
            $ref: '#/components/schemas/TemporalTrend'
        generated_at:
          type: string
          format: date-time
          description: Timestamp when statistics were generated

    CrossAnalysisCell:
      type: object
      description: A single cell in the cross-analysis matrix
      required: [row_value, column_value, count]
      properties:
        row_value:
          type: string
          description: Row dimension value
          example: "Renaissance"
        column_value:
          type: string
          description: Column dimension value
          example: "oil paint"
        column_uri:
          type: string
          format: uri
          description: Column dimension URI (for Getty materials)
        count:
          type: integer
          description: Number of artworks matching both dimensions

    CrossAnalysisResponse:
      type: object
      description: Cross-category analysis response
      required: [dimension_x, dimension_y, x_values, y_values, matrix, total_artworks, generated_at]
      properties:
        dimension_x:
          type: string
          description: X-axis dimension name
          example: "period"
        dimension_y:
          type: string
          description: Y-axis dimension name
          example: "material"
        x_values:
          type: array
          items:
            type: string
          description: Unique values for X dimension
        y_values:
          type: array
          items:
            type: string
          description: Unique values for Y dimension
        matrix:
          type: array
          items:
            $ref: '#/components/schemas/CrossAnalysisCell'
        total_artworks:
          type: integer
          description: Total artworks in analysis
        generated_at:
          type: string
          format: date-time
          description: Timestamp when statistics were generated

    StatisticsQueryRequest:
      type: object
      description: Request for custom statistics SPARQL query
      required: [query]
      properties:
        query:
          type: string
          description: SPARQL query (Getty prefixes will be auto-injected)
          example: "SELECT ?material (COUNT(?artwork) AS ?count) WHERE { ?artwork schema:artMedium ?material } GROUP BY ?material"
        include_getty_prefixes:
          type: boolean
          description: Whether to auto-inject Getty namespace prefixes
          default: true

    StatisticsQueryResponse:
      type: object
      description: Response for custom statistics query
      required: [success]
      properties:
        success:
          type: boolean
          description: Whether the query executed successfully
        results:
          type: object
          additionalProperties: true
          description: SPARQL query results
        error:
          type: string
          description: Error message if query failed
        execution_time_ms:
          type: integer
          description: Query execution time in milliseconds

    # ----------------------------------------
    # Error Schemas
    # ----------------------------------------
    Error:
      type: object
      required: [error]
      properties:
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
              description: Error code
              example: "NOT_FOUND"
            message:
              type: string
              description: Human-readable error message
              example: "Artwork not found"
            details:
              type: object
              additionalProperties: true
              description: Additional error details

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "BAD_REQUEST"
              message: "Invalid request parameters"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "NOT_FOUND"
              message: "The requested resource was not found"

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "VALIDATION_ERROR"
              message: "Request validation failed"
              details:
                field: "title"
                issue: "Title is required"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: "INTERNAL_ERROR"
              message: "An unexpected error occurred"
